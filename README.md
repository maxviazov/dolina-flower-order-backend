# Dolina Flower Order Backend

Серверная часть системы заказа цветов для компании Dolina. Проект разработан с учетом масштабируемости и лучших практик Go.

## Описание проекта

Система предназначена для:
1. Предоставления клиентам возможности формирования заказов на поставку цветов через онлайн-форму
2. Обработки заказов специалистами компании
3. Формирования Excel-таблиц для отправки заказов на цветочную ферму

## Архитектура

Проект построен с использованием чистой архитектуры и следующих принципов:
- **Синглтон** для конфигурации и логгера
- **Контекст Go** для управления жизненным циклом
- **Горутины** для многопоточности
- **Graceful shutdown** для корректного завершения
- **Структурированное логирование** с zerolog

## Структура проекта

```
├── cmd/                    # Точки входа приложения
├── internal/              # Внутренняя логика приложения
│   ├── app/              # Основное приложение
│   ├── config/           # Конфигурация
│   └── logger/           # Кастомный логгер
├── pkg/                  # Публичные пакеты
├── testfiles/           # Тестовые файлы Excel
├── terraform/           # Инфраструктура как код
├── .env.example         # Пример переменных окружения
├── config.example.json  # Пример конфигурации
└── README.md           # Документация
```

## Быстрый старт

### Предварительные требования

- Go 1.25.3+
- PostgreSQL (для будущих версий)

### Установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd dolina-flower-order-backend
```

2. Установите зависимости:
```bash
go mod download
```

3. Скопируйте и настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env файл под ваши нужды
```

4. Запустите приложение:
```bash
go run cmd/server/main.go
```

### Конфигурация

Приложение поддерживает конфигурацию через:
- Переменные окружения (приоритет)
- JSON файл конфигурации
- Значения по умолчанию

#### Переменные окружения

Основные переменные окружения:
- `SERVER_HOST` - хост сервера (по умолчанию: localhost)
- `SERVER_PORT` - порт сервера (по умолчанию: 8081)
- `LOG_LEVEL` - уровень логирования (trace, debug, info, warn, error, fatal, panic)
- `LOG_FORMAT` - формат логов (json, console)
- `JWT_SECRET` - секретный ключ для JWT токенов

Полный список переменных см. в `.env.example`.

#### Файл конфигурации

Для использования JSON конфигурации установите переменную:
```bash
export CONFIG_FILE=./config.json
```

Пример конфигурации см. в `config.example.json`.

## API Endpoints

### Health Check
- `GET /health` - проверка состояния сервиса

### API v1
- `GET /api/v1/ping` - тестовый endpoint

## Разработка

### Логирование

Проект использует структурированное логирование с zerolog:
```go
```go
logger := logger.GetLogger()
logger.Info("Application started")
logger.WithField("user_id", "123").Error("User not found")
```

### Конфигурация

Конфигурация реализована как синглтон:

```go
cfg := config.GetConfig()
fmt.Println(cfg.Server.Port)
```

### Контекст

Все операции должны использовать контекст:

```go
func (h *Handler) ProcessOrder(ctx context.Context, orderID string) error {
    // Используйте ctx для отмены операций и передачи значений
}
```

## Развертывание

### Локальное развертывание

```bash
go build -o bin/server main.go
./bin/server
```

### Docker (планируется)

```bash
docker build -t dolina-flower-backend .
docker run -p 8080:8080 dolina-flower-backend
```

### AWS Lambda (поддерживается)

Проект готов к развертыванию в AWS Lambda через Terraform.

## Тестирование

```bash
# Запуск всех тестов
go test ./...

# Запуск тестов с покрытием
go test -cover ./...

# Запуск бенчмарков
go test -bench=. ./...
```

## Мониторинг

- Структурированные логи в JSON формате
- Health check endpoint
- Метрики производительности (планируется)

## Безопасность

- CORS настройки
- JWT аутентификация (планируется)
- Валидация входных данных
- Безопасное хранение секретов

## Roadmap

### MVP (текущая версия)
- [x] Базовая архитектура
- [x] Конфигурация и логирование
- [x] HTTP сервер с Gin
- [ ] Модели данных для заказов
- [ ] API для создания заказов
- [ ] Обработка заказов специалистами

### Версия 1.0
- [ ] База данных PostgreSQL
- [ ] Аутентификация и авторизация
- [ ] Генерация Excel файлов
- [ ] Загрузка изображений
- [ ] Email уведомления

### Версия 2.0
- [ ] Микросервисная архитектура
- [ ] Кэширование с Redis
- [ ] Очереди сообщений
- [ ] Метрики и мониторинг
- [ ] CI/CD pipeline

## Вклад в проект

1. Форкните репозиторий
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте в ветку (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## Лицензия

Этот проект является частной разработкой для компании Dolina.

## Контакты

- Разработчик: Maxim Viazov
- Email: maxim@viazov.com
- Проект: [ссылка на репозиторий]
